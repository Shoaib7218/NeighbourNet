<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Community Page</title>-->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <style>-->
<!--        .chatroom {-->
<!--            height: 250px; /* Reduced height */-->
<!--            overflow-y: auto;-->
<!--            border: 1px solid #ddd;-->
<!--            border-radius: 5px;-->
<!--            padding: 10px;-->
<!--        }-->

<!--        .member-list {-->
<!--            border: 1px solid #ddd;-->
<!--            border-radius: 5px;-->
<!--            padding: 10px;-->
<!--            max-height: 250px; /* Matches chatroom height */-->
<!--            overflow-y: auto;-->
<!--        }-->

<!--        .feature-card {-->
<!--            border: 1px solid #ddd;-->
<!--            border-radius: 5px;-->
<!--            padding: 15px;-->
<!--            text-align: center;-->
<!--            height: 100%;-->
<!--        }-->

<!--        .feature-icon {-->
<!--            font-size: 24px;-->
<!--            margin-bottom: 10px;-->
<!--        }-->

<!--        /* To ensure everything fits neatly */-->
<!--        body {-->
<!--            height: 100vh;-->
<!--            margin: 0;-->
<!--        }-->

<!--        .container {-->
<!--            height: 100%; /* Use full height */-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            justify-content: flex-start; /* Align items to the top */-->
<!--        }-->

<!--        .feature-row {-->
<!--            margin-top: 20px; /* Reduce gap between the sections */-->
<!--        }-->

<!--        /* Adjust margins for a better look */-->
<!--        .row {-->
<!--            margin-bottom: 20px;-->
<!--        }-->

<!--        /* Style for the community name */-->
<!--        .community-name {-->
<!--            text-align: center;-->
<!--            font-size: 36px;-->
<!--            font-weight: bold;-->
<!--            margin-bottom: 20px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <div class="container mt-4">-->
<!--        &lt;!&ndash; Community Name &ndash;&gt;-->
<!--        <div class="community-name">-->
<!--            <h1>COMMUNITY : {{community_name}}</h1> &lt;!&ndash; Replace with your community name &ndash;&gt;-->
<!--        </div>-->

<!--        &lt;!&ndash; First Row: Chatroom and Members &ndash;&gt;-->
<!--        <div class="row">-->
<!--            &lt;!&ndash; Chatroom Section &ndash;&gt;-->
<!--            <div class="col-md-8">-->
<!--                <h2>Chatroom</h2>-->
<!--                <div class="chatroom" id="chatroom">-->
<!--                    {%for message in messages%}-->
<!--                        <p><strong>{{message}}</strong></p>-->
<!--                    {%endfor%}-->
<!--&lt;!&ndash;                    <p><strong>John:</strong> Hello, everyone!</p>&ndash;&gt;-->
<!--&lt;!&ndash;                    <p><strong>Jane:</strong> Hi, John! How's it going?</p>&ndash;&gt;-->
<!--&lt;!&ndash;                    <p><strong>Emily:</strong> Good afternoon!</p>&ndash;&gt;-->
<!--&lt;!&ndash;                    <p><strong>Mark:</strong> Anyone up for a meeting?</p>&ndash;&gt;-->
<!--&lt;!&ndash;                    <p><strong>Susan:</strong> Yes, let's do it!</p>&ndash;&gt;-->
<!--                </div>-->
<!--&lt;!&ndash;                <form class="mt-3" id="messageForm">&ndash;&gt;-->
<!--                    <div class="input-group">-->
<!--                        <input type="text" id="message" class="form-control" placeholder="Type your message...">-->
<!--                        <button class="btn btn-primary" onclick="sendMessage()">Send</button>-->
<!--                    </div>-->
<!--&lt;!&ndash;                </form>&ndash;&gt;-->
<!--            </div>-->

<!--            &lt;!&ndash; Member List Section &ndash;&gt;-->
<!--            <div class="col-md-4">-->
<!--                <h3>Members</h3>-->

<!--                <div class="member-list" id="members">-->
<!--                  <ul class="list-unstyled">-->
<!--        {% for member in members %}-->
<!--            <li>{{ member }}</li>-->
<!--        {% else %}-->
<!--            <li>No members found.</li>-->
<!--        {% endfor %}-->
<!--    </ul>-->
<!--&lt;!&ndash;                        <li>Jane Smith</li>&ndash;&gt;-->
<!--&lt;!&ndash;                        <li>Mark Johnson</li>&ndash;&gt;-->
<!--&lt;!&ndash;                        <li>Emily Davis</li>&ndash;&gt;-->
<!--&lt;!&ndash;                        <li>Susan Brown</li>&ndash;&gt;-->
<!--&lt;!&ndash;                        <li>Michael White</li>&ndash;&gt;-->
<!--&lt;!&ndash;                        <li>Olivia Green</li>&ndash;&gt;-->
<!--&lt;!&ndash;                        <li>James Black</li>&ndash;&gt;-->
<!--&lt;!&ndash;                        <li>Charlotte Gray</li>&ndash;&gt;-->
<!--&lt;!&ndash;                        <li>William Harris</li>&ndash;&gt;-->
<!--&lt;!&ndash;                        <li>Emma Walker</li>&ndash;&gt;-->
<!--                    </ul>-->
<!--                </div>-->

<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Second Row: Notifications, Events, Lost & Found &ndash;&gt;-->
<!--        <div class="row feature-row">-->
<!--            <div class="col-md-4">-->
<!--                <div class="feature-card">-->
<!--                    <div class="feature-icon">üì¢</div>-->
<!--                    <h3>Notifications</h3>-->
<!--                    <p>Stay informed with instant updates via email.</p>-->
<!--                    <button class="btn btn-secondary" disabled>Coming Soon</button>-->
<!--                </div>-->
<!--            </div>-->

<!--            <div class="col-md-4">-->
<!--                <div class="feature-card">-->
<!--                    <div class="feature-icon">üìÖ</div>-->
<!--                    <h3>Events</h3>-->
<!--                    <p>Check out upcoming community events.</p>-->
<!--                    <a href="/events" class="btn btn-primary">View Events</a>-->
<!--                </div>-->
<!--            </div>-->

<!--            <div class="col-md-4">-->
<!--                <div class="feature-card">-->
<!--                    <div class="feature-icon">üîç</div>-->
<!--                    <h3>Lost & Found</h3>-->
<!--                    <p>Report or find lost items in the community.</p>-->
<!--                    <a href="/lost-and-found" class="btn btn-primary">Go to Lost & Found</a>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>-->
<!--    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->
<!--    <script>-->
<!--        var socket = io.connect('http://localhost:5000');-->
<!--        var room = '{{ community_id }}'; // Room (community ID) passed from Flask-->
<!--        var username = prompt("Enter your username");-->

<!--        // Join the room (community) when the page loads-->
<!--        socket.emit('join', {username: username, room: room});-->

<!--        // Listen for messages from the server-->
<!--        socket.on('message', function(message) {-->
<!--            var messagesList = document.getElementById("chatroom");-->
<!--            var newMessage = document.createElement("li");-->
<!--            newMessage.textContent = message;-->
<!--            messagesList.appendChild(newMessage);-->
<!--        });-->

<!--        // Send message function-->
<!--        function sendMessage() {-->
<!--            var messageInput = document.getElementById("message");-->
<!--            var message = messageInput.value;-->

<!--            if (message.trim() !== "") {-->
<!--                socket.emit('message', {username: username, message: message, room: room});-->
<!--                messageInput.value = '';  // Clear the input after sending-->
<!--            }-->
<!--        }-->

<!--        // When the user leaves the community (e.g., closes the page)-->
<!--        window.onbeforeunload = function() {-->
<!--            socket.emit('leave', {username: username, room: room});-->
<!--        };-->
<!--    </script>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        .chatroom {
            height: 250px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }

        .member-list {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            max-height: 250px;
            overflow-y: auto;
        }

        .feature-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            height: 100%;
        }

        .feature-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }

        body {
            height: 100vh;
            margin: 0;
        }

        .container {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .feature-row {
            margin-top: 20px;
        }

        .row {
            margin-bottom: 20px;
        }

        .community-name {
            text-align: center;
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .member-item {
            position: relative;
        }

        .dropdown {
            margin-left: auto;
        }

        .community-name {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

    </style>
</head>
<body>
    <div class="container mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    {% endif %}
{% endwith %}
        <!-- Community Name -->
<!--        <div class="community-name">-->
<!--            <h1>COMMUNITY : {{community_name}}</h1>-->
<!--        </div>-->

        <div class="community-name d-flex justify-content-between align-items-center">
    <h1>COMMUNITY: {{community_name}}</h1>
    {% if is_admin %}
        <a href="#" onclick="confirmDeletion('{{ url_for('c_page.delete_community', community_id=community_id) }}')" class="btn btn-sm btn-danger">Delete Community</a>
    {% endif %}
</div>



        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link {% if request.args.get('_anchor') == 'chatroom-tab' or not request.args.get('_anchor') %}active{% endif %}" id="chatroom-tab" data-bs-toggle="tab" href="#chatroom-content">Chatroom</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.args.get('_anchor') == 'events-tab' %}active{% endif %}" id="events-tab" data-bs-toggle="tab" href="#events-content">Events</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.args.get('_anchor') == 'lostfound-tab' %}active{% endif %}" id="lostfound-tab" data-bs-toggle="tab" href="#lostfound-content">Lost & Found</a>
            </li>
            {% if is_admin %}
            <li class="nav-item">
                <a class="nav-link {% if request.args.get('_anchor') == 'requests-tab' %}active{% endif %}" id="requests-tab" data-bs-toggle="tab" href="#requests-content">Requests</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.args.get('_anchor') == 'addusers-tab' %}active{% endif %}" id="addusers-tab" data-bs-toggle="tab" href="#addusers-content">Add Users</a>
            </li>
            {% endif %}
        </ul>

        <!-- Tab Contents -->
        <div class="tab-content">
            <!-- Chatroom Tab -->
            <div class="tab-pane fade {% if request.args.get('_anchor') == 'chatroom-tab' or not request.args.get('_anchor') %}show active{% endif %}" id="chatroom-content">
                <div class="row">
                    <div class="col-md-8">
                        <h2>Chatroom</h2>
                        <div class="chatroom" id="chatroom">
                            <!-- Chatroom messages will go here -->
                        </div>
                        <div class="input-group mt-3">
                            <input type="text" id="message" class="form-control" placeholder="Type your message...">
                            <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                        </div>
                    </div>
                    <h3>Members</h3>
                    <a href="#" onclick="confirmleavegroup('{{url_for('home.leave_group',community_id=community_id)}}')"> <button class="btn btn-sm btn-danger">Leave Group</button></a>
                    <div class="member-list" id="members">
                        <ul class="list-unstyled">
                            {% for member in members %}
                                <li class="member-item d-flex justify-content-between align-items-center">
                                    <span>
                                        {{ member.first_name }} {{ member.last_name }}
                                        {% if admin_username == member.username %}
                                            <i class="bi bi-star-fill text-warning" title="Admin"></i>
                                        {% endif %}
                                    </span>
                                    {% if admin_username != member.username and admin_username == user %}
                                        <div class="dropdown">
                                            <a href="#" class="text-dark" id="dropdownMenuButton{{ loop.index }}" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </a>
                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton{{ loop.index }}">
                                                <li><a class="dropdown-item" href="{{url_for('c_page.make_admin', new_admin_username=member.username, community_id=community_id)}}">Make Admin</a></li>
                                                <li><a class="dropdown-item" href="{{url_for('c_page.remove_user_by_admin', member_username=member.username, community_id=community_id)}}">Remove</a></li>
                                            </ul>
                                        </div>
                                    {% endif %}
                                </li>
                            {% else %}
                                <li>No members found.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Events Tab -->
            <div class="tab-pane fade {% if request.args.get('_anchor') == 'events-tab' %}show active{% endif %}" id="events-content">
                <div class="feature-card">
                    <div class="feature-icon">üìÖ</div>
                    <h3>Events</h3>
                    <p>Check out upcoming community events.</p>
                    <a href="{{url_for('c_page.render_view_comm',community_id=community_id)}}" class="btn btn-primary">View Events</a>
                </div>
            </div>

            <!-- Lost & Found Tab -->
            <div class="tab-pane fade {% if request.args.get('_anchor') == 'lostfound-tab' %}show active{% endif %}" id="lostfound-content">
                <div class="feature-card">
                    <div class="feature-icon">üîç</div>
                    <h3>Lost & Found</h3>
                    <p>Report or find lost items in the community.</p>
                    <a href="{{url_for('c_page.render_l_and_f',community_id=community_id)}}" class="btn btn-primary">Go to Lost & Found</a>
                </div>
            </div>

            <!-- Requests Tab -->
            <div class="tab-pane fade {% if request.args.get('_anchor') == 'requests-tab' %}show active{% endif %}" id="requests-content">
                <div class="feature-card">
                    <div class="feature-icon">üìã</div>
                    <h3>Requests</h3>
                    <p>Review and manage join requests.</p>
                    <ul class="list-group">
                        {% for request in requests %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <img src="path-to-user-dp.jpg" class="rounded-circle me-2" alt="User DP" width="40" height="40">
                                    <div>
                                        <span>{{request['first_name']}}</span><br>
                                        <span>{{request['last_name']}}</span>
                                    </div>
                                </div>
                                <div>
                                    <a href="{{url_for('c_page.accept_request_admin', community_id=community_id, request_username=request.username)}}"><button class="btn btn-success btn-sm">Accept</button></a>
                                    <a href="{{url_for('c_page.reject_request_admin', community_id=community_id, request_username=request.username)}}"><button class="btn btn-danger btn-sm">Reject</button></a>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <!-- Add Users Tab -->
            <div class="tab-pane fade {% if request.args.get('_anchor') == 'addusers-tab' %}show active{% endif %}" id="addusers-content">
                <div class="feature-card">
                    <div class="feature-icon">‚ûï</div>
                    <h3>Add Users</h3>
                    <p>Search and add users to communities.</p>
                    <a href="{{ url_for('c_page.go_to_search', community_id=community_id) }}">
                        <button class="btn btn-primary">Search Users</button>
                    </a>
                </div>
            </div>
        </div>
    </div>




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io.connect('http://localhost:5000');
        var room = '{{ community_id }}'; // Room (community ID) passed from Flask
        var username = '{{first_}}';

        // Join the room (community) when the page loads
        socket.emit('join', {username: username, room: room});

        // Listen for messages from the server
        socket.on('message', function(message) {
            var messagesList = document.getElementById("chatroom");
            var newMessage = document.createElement("p");
            newMessage.innerHTML = "<strong>" + message + "</strong>";
            messagesList.appendChild(newMessage);
        });

        // Send message function
        function sendMessage() {
            var messageInput = document.getElementById("message");
            var message = messageInput.value;

            if (message.trim() !== "") {
                socket.emit('message', {username: username, message: message, room: room});
                messageInput.value = '';  // Clear the input after sending
            }
        }

        // When the user leaves the community (e.g., closes the page)
        window.onbeforeunload = function() {
            socket.emit('leave', {username: username, room: room});
        };
    </script>


    <script>
document.getElementById('search-button').addEventListener('click', function() {
    var query = document.querySelector('input[name="query"]').value;
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '{{ url_for('c_page.search_users', community_id=community_id) }}', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            document.getElementById('search-results').innerHTML = xhr.responseText;
        }
    };
    xhr.send('query=' + encodeURIComponent(query));
});
</script>

<script>
function confirmDeletion(url) {
    if (confirm("Are you sure you want to delete this community? This action cannot be undone.")) {
        window.location.href = url;
    }
}
</script>

<script>
    function confirmleavegroup(url) {
    if (confirm("Are you sure you want to leave group ? This action cannot be undone.")) {
     window.location.href=url;
    }
    }
</script>


</body>
</html>
